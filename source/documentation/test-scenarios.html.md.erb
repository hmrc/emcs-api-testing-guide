---
title: Test scenarios
weight: 40
---

# Test scenarios
<%= partial 'documentation/partials/google_tag_manager_js' %>
You should test the following scenarios to make sure your software is compatible with EMCS API.

## Endpoint: Submit a new draft excise movement.

You should test [this endpoint](/api-documentation/docs/api/service/excise-movement-control-system-api/1.0/oas/page#tag/Movements/operation/submitMovement) first.

To test this endpoint in the External Test environment, you will need to provide a request with an XML body that conforms to the [IE815 XML Schema](https://github.com/hmrc/excise-movement-control-system-api/blob/main/app/xsd/ie815-v16-0.xsd). An [IE815 example XML](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE815.xml) can be found on GitHub.

### Get messages

If you also want to test the endpoint ['Get all messages for an excise movement using the localReferenceNumber'](#endpoint-get-all-messages-for-an-excise-movement-using-the-localreferencenumber), you must use one of these LRNs in the body of the XML message:

```
lrnie8158976912
lrnie8156540856
lrnie8155973812
lrnie8151695045
lrnie8155743934
lrnie8154968571
lrnie8151232757
lrnie8153786132
lrnie8158366950
lrnie8157359518
```

You should make sure the example LRNs are copied exactly, and are lowercase.

### Error cases

You can activate specific responses by passing in specific values in 2 ways:

1. As a local reference number (LRN). This is a legacy testing method and will be deprecated.
2. As a MessageIdentifier value in the XML header. This is the preferred method and will take the form below:

```
<urn:Message>
    <urn:Header>
      <urn1:MessageSender>token</urn1:MessageSender>
      <urn1:MessageRecipient>token</urn1:MessageRecipient>
      <urn1:DateOfPreparation>2008-09-29</urn1:DateOfPreparation>
      <urn1:TimeOfPreparation>00:18:33</urn1:TimeOfPreparation>
      <urn1:MessageIdentifier>[MESSAGE IDENTIFIER VALUE]</urn1:MessageIdentifier>
      <!--Optional:-->
      <urn1:CorrelationIdentifier>token</urn1:CorrelationIdentifier>
    </urn:Header>
</urn:Message>
```

You can send the following values to simulate responses:


| Message Identifier / LRN value     | 	Response                 |
|:-----------------------------|:--------------------------|
| SendA400                     | 400 Bad Request           |
| SendA404                     | 404 Not Found             |
| SendA500                     | 500 Internal Server Error |
| SendA503                     | 503 Service Unavailable   |
| Any other valid value        | 202 Accepted              |

A success response will take the form of 

```
{
  "consignorId": "GBWK002281023",
  "consigneeId": "GBWKQOZ8OVLYR",
  "localReferenceNumber": "LRNQA20230909022221",
  "status": "Accepted"
}
```

A 400 Bad Request error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Json validation failed",
  "debugMessage": "user is missing but it is required",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```
If the XML is invalid, a 400 Bad Request error response will be returned in the form of

```
{
  "message": "Validation error(s) occurred",
  "errors": [
    {
      "errorCode": 8084,
      "errorMessage": "The Date of Dispatch you entered is incorrect. It must be today or later. Please amend your entry and resubmit.",
      "location": "/urn:IE815[1]/urn:Body[1]/urn:SubmittedDraftOfEADESAD[1]/urn:EadEsadDraft[1]/urn:DateOfDispatch[1]",
      "value": "2023-09-09"
    }
  ]
}
```

A 404 Not Found error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Received error response from server",
  "debugMessage": "Connection refused; nested exception is java.net.ConnectException: Connection refused",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 500 Internal Server Error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Invalid JSON structure",
  "debugMessage": "JSON parse error: Unexpected character",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 503 Service Unavailable error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "CIRCUIT_BREAKER - 815_CB is OPEN",
  "debugMessage": "CircuitBreaker '815_CB' is OPEN and does not permit further calls",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```
## Endpoint: Get excise movements

You must make sure you have first tested the [Submit a draft excise movement (IE815) endpoint](#endpoint-submit-a-new-draft-excise-movement), and received a success response.

You can test [this endpoint](/api-documentation/docs/api/service/excise-movement-control-system-api/1.0/oas/page#tag/Movements/operation/getAllMovements) in the External Test environment by calling `https://test-api.service.hmrc.gov.uk/customs/excise/movements?lrn=[YOUR_LRN]&ern=[YOUR_ERN]&arc=[YOUR_ARC]`.

A success response will take the form of 

```
[
  {
    "consignorId": "GBWK002281023",
    "consigneeId": "GBWKQOZ8OVLYR",
    "localReferenceNumber": "LRNQA20230909022221",
    "administrativeReferenceCode": "35WE3B5EDSYSZ86STVKH8",
    "status": "Accepted"
  },
  {
    "consignorId": "GBWK002281023",
    "consigneeId": "GBWKQOZ8OVLYQ",
    "localReferenceNumber": "LRNQA20230909022224",
    "status": "None"
  }
]
```

## Endpoint: Submit a message for an excise movement

You must make sure you have first tested the [Submit a draft excise movement (IE815) endpoint](#endpoint-submit-a-new-draft-excise-movement), and received a success response, before testing [this endpoint](/api-documentation/docs/api/service/excise-movement-control-system-api/1.0/oas/page#tag/Movements/operation/postMessage) in the External Test environment.

### IE818 - Report of receipt

You will need to provide a request with an XML body that conforms to the [IE818 XML Schema](https://github.com/hmrc/excise-movement-control-system-api/blob/main/app/xsd/ie818.xsd). An [IE818 example XML](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE818.xml) can be found on GitHub.

You can activate specific responses by passing in specific values in 2 ways:

1. As a ComplementaryInformation value in the XML body. This is a legacy testing method and will be deprecated.
2. As a MessageIdentifier value in the XML header. This is the preferred method and will take the form below:

```
<urn:Message>
    <urn:Header>
      <urn1:MessageSender>token</urn1:MessageSender>
      <urn1:MessageRecipient>token</urn1:MessageRecipient>
      <urn1:DateOfPreparation>2008-09-29</urn1:DateOfPreparation>
      <urn1:TimeOfPreparation>00:18:33</urn1:TimeOfPreparation>
      <urn1:MessageIdentifier>[MESSAGE IDENTIFIER VALUE]</urn1:MessageIdentifier>
      <!--Optional:-->
      <urn1:CorrelationIdentifier>token</urn1:CorrelationIdentifier>
    </urn:Header>
</urn:Message>
```
You can send the following values to simulate responses:

| MessageIdentifier / ComplementaryInformation value    | 	Response                 |
|:-----------------------------|:--------------------------|
| SendA400                     | 400 Bad Request           |
| SendA404                     | 404 Not Found             |
| SendA500                     | 500 Internal Server Error |
| SendA503                     | 503 Service Unavailable   |
| Any other valid value        | 202 Accepted             |

A success response will have headers and a status, but will contain no body content.

A 400 Bad Request error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Json validation failed",
  "debugMessage": "user is missing but it is required",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 404 Not Found error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Received error response from server",
  "debugMessage": "Connection refused; nested exception is java.net.ConnectException: Connection refused",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 500 Internal Server Error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Invalid JSON structure",
  "debugMessage": "JSON parse error: Unexpected character",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 503 Service Unavailable error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "CIRCUIT_BREAKER - 815_CB is OPEN",
  "debugMessage": "CircuitBreaker '815_CB' is OPEN and does not permit further calls",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

### All other messages

Below is a list of messages that you can test, along with their relevant XML schema and example XMLs:

| Message | Schema link | Example XML |
| --- | --- | --- |
| IE810 - Cancellation | [IE810 XSD](https://github.com/hmrc/excise-movement-control-system-api/blob/main/app/xsd/ie810.xsd) | [IE810 example XML](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE810.xml) |
| IE813 - Change of destination | [IE813 XSD](https://github.com/hmrc/excise-movement-control-system-api/blob/main/app/xsd/ie813.xsd) | [IE813 example XML](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE813.xml) |
| IE819 - Alert or rejection of E-AD/E-SAD | [IE819 XSD](https://github.com/hmrc/excise-movement-control-system-api/blob/main/app/xsd/ie819.xsd) | [IE819 example XML](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE819.xml) |
| IE837 - Explain delay to delivery | [IE837 XSD](https://github.com/hmrc/excise-movement-control-system-api/blob/main/app/xsd/ie837.xsd) | [IE837 example XML from consignor](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE837_consignor.xml)<br></br>[IE837 example XML from consignee](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE837_consignee.xml) |
| IE871 - Reason for shortage | [IE871 XSD](https://github.com/hmrc/excise-movement-control-system-api/blob/main/app/xsd/ie871.xsd) | [IE871 example XML](https://github.com/hmrc/excise-movement-control-system-api/blob/main/resources/public/api/conf/1.0/examples/IE810.xml) |

You will need to provide a request with an XML body that conforms to the relevant XML Schema.

Within the XML header you can activate specific responses by passing in specific MessageIdentifier values, as in the form below:

```
<urn:Message>
    <urn:Header>
      <urn1:MessageSender>token</urn1:MessageSender>
      <urn1:MessageRecipient>token</urn1:MessageRecipient>
      <urn1:DateOfPreparation>2008-09-29</urn1:DateOfPreparation>
      <urn1:TimeOfPreparation>00:18:33</urn1:TimeOfPreparation>
      <urn1:MessageIdentifier>[MESSAGE IDENTIFIER VALUE]</urn1:MessageIdentifier>
      <!--Optional:-->
      <urn1:CorrelationIdentifier>token</urn1:CorrelationIdentifier>
    </urn:Header>
</urn:Message>
```

You can send the following MessageIdentifier values to simulate responses:


| MessageIdentifier value     | 	Response                 |
|:-----------------------------|:--------------------------|
| SendA400                     | 400 Bad Request           |
| SendA404                     | 404 Not Found             |
| SendA500                     | 500 Internal Server Error |
| SendA503                     | 503 Service Unavailable   |
| Any other valid value        | 202 Accepted              |

A success response will have headers and a status, but will contain no body content.

A 400 Bad Request error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Json validation failed",
  "debugMessage": "user is missing but it is required",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 404 Not Found error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Received error response from server",
  "debugMessage": "Connection refused; nested exception is java.net.ConnectException: Connection refused",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 500 Internal Server Error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "Invalid JSON structure",
  "debugMessage": "JSON parse error: Unexpected character",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

A 503 Service Unavailable error response will take the form of

```
{
  "dateTime": "2021-12-17T09:30:47Z",
  "message": "CIRCUIT_BREAKER - 815_CB is OPEN",
  "debugMessage": "CircuitBreaker '815_CB' is OPEN and does not permit further calls",
  "emcsCorrelationId": "3e8dae97-b586-4cef-8511-68ac12da9028"
}
```

## Endpoint: Get all messages for an excise movement using the localReferenceNumber

You must make sure you have first tested the [Submit a draft excise movement (IE815) endpoint](#endpoint-submit-a-new-draft-excise-movement). You must have used one of the LRNs below in the body of the XML message, and received a success response.

You can test [this endpoint](/api-documentation/docs/api/service/excise-movement-control-system-api/1.0/oas/page#tag/Movements/operation/getAllMessages) in the External Test environment by calling `https://test-api.service.hmrc.gov.uk/customs/excise/movements/{localReferenceNumber}/messages`.

If you replace `{localReferenceNumber}` in the URL with one of these LRNs, you will return a success response:

```
lrnie8158976912
lrnie8156540856
lrnie8155973812
lrnie8151695045
lrnie8155743934
lrnie8154968571
lrnie8151232757
lrnie8153786132
lrnie8158366950
lrnie8157359518
```

You should make sure the example LRNs are copied exactly, and are lowercase. Any other valid LRN will return no messages.

A success response will take the form of 

```
[
  {
    "encodedMessage": "PElFODE1PjwhLS0gRXhhbXBsZSBJRTgxNSBtZXNzYWdlIC0tPjwvSUU4MTU+",
    "createdOn": "2023-10-30T15:36:08.985Z",
    "type": "IE815"
  },
  {
    "encodedMessage": "PElFODAxPjwhLS0gRXhhbXBsZSBJRTgwMSBtZXNzYWdlIC0tPjwvSUU4MDE+",
    "createdOn": "2023-10-28T15:36:08.985Z",
    "type": "IE801"
  }
]
```